<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klubbens Webbplats</title>
    <!-- Använd Tailwind CSS för en snygg och responsiv design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        /* Modal-styling för felmeddelanden och bekräftelse */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 0.75rem;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        .modal-close-btn {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Header och navigering -->
    <header class="bg-blue-800 text-white shadow-lg">
        <div class="container py-4 flex flex-col sm:flex-row justify-between items-center">
            <a href="#" class="text-3xl font-bold tracking-tight mb-4 sm:mb-0">Klubbnamn</a>
            <nav>
                <ul class="flex space-x-4 font-medium">
                    <li><a href="#hem" class="hover:text-gray-300 transition duration-300">Hem</a></li>
                    <li><a href="#nyheter" class="hover:text-gray-300 transition duration-300">Nyheter</a></li>
                    <li><a href="#kalender" class="hover:text-gray-300 transition duration-300">Kalender</a></li>
                    <li><a href="#admin" class="hover:text-gray-300 transition duration-300">Admin</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Huvudinnehåll -->
    <main class="container">

        <!-- Sida: Hem -->
        <section id="hem" class="page active">
            <div class="bg-blue-100 p-8 rounded-xl text-center mb-8">
                <h1 class="text-4xl font-extrabold text-blue-900 mb-4">Välkommen till Klubbnamn!</h1>
                <p class="text-lg text-blue-700">Vi är en klubb för entusiaster av [klubben's intresse]. Här kan du hitta information om vår historia, nyheter och kommande evenemang.</p>
            </div>
            
            <h2 class="text-3xl font-bold mb-4">Senaste Nyheterna</h2>
            <div id="home-news-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Nyheter kommer att renderas här av JavaScript -->
            </div>

            <div class="mt-8 card">
                <h2 class="text-3xl font-bold mb-4">Klubbens Historia</h2>
                <p class="text-gray-700 leading-relaxed">
                    Klubbens historia sträcker sig tillbaka till [År]. Grundad av en passionerad grupp av [intresse], har vi vuxit till en samlingspunkt för likasinnade. Genom åren har vi arrangerat otaliga evenemang och byggt en stark gemenskap. Vårt mål är att fortsätta [klubbens mål].
                </p>
            </div>
        </section>

        <!-- Sida: Nyheter -->
        <section id="nyheter" class="page">
            <h1 class="text-4xl font-bold mb-6">Alla Nyheter</h1>
            <div id="all-news-container" class="space-y-6">
                <!-- Nyheter kommer att renderas här av JavaScript -->
            </div>
        </section>

        <!-- Sida: Kalender -->
        <section id="kalender" class="page">
            <h1 class="text-4xl font-bold mb-6">Kalender</h1>
            <div id="calendar-container" class="space-y-6">
                <!-- Kalenderhändelser kommer att renderas här av JavaScript -->
            </div>
        </section>

        <!-- Sida: Admin -->
        <section id="admin" class="page">
            <div id="admin-login-panel" class="card max-w-md mx-auto">
                <h1 class="text-2xl font-bold mb-4">Admininloggning</h1>
                <input type="password" id="admin-password" placeholder="Lösenord" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                <button id="login-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300">Logga in</button>
            </div>

            <div id="admin-panel" class="hidden">
                <h1 class="text-4xl font-bold mb-6">Administrationspanel</h1>
                <div id="admin-user-info" class="mb-4 text-sm text-gray-500"></div>
                
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4">Lägg till Nyhet</h2>
                    <form id="add-news-form">
                        <label for="news-title" class="block mb-2 font-semibold">Titel</label>
                        <input type="text" id="news-title" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                        
                        <label for="news-content" class="block mb-2 font-semibold">Innehåll</label>
                        <textarea id="news-content" rows="6" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"></textarea>
                        
                        <button type="submit" id="add-news-btn" disabled class="bg-gray-400 text-white font-bold py-3 px-4 rounded-lg">Lägg till</button>
                    </form>
                </div>

                <div class="card mt-6">
                    <h2 class="text-2xl font-bold mb-4">Lägg till Kalenderhändelse</h2>
                    <form id="add-event-form">
                        <label for="event-title" class="block mb-2 font-semibold">Titel</label>
                        <input type="text" id="event-title" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">

                        <label for="event-date" class="block mb-2 font-semibold">Datum</label>
                        <input type="date" id="event-date" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                        
                        <label for="event-description" class="block mb-2 font-semibold">Beskrivning</label>
                        <textarea id="event-description" rows="4" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"></textarea>
                        
                        <button type="submit" id="add-event-btn" disabled class="bg-gray-400 text-white font-bold py-3 px-4 rounded-lg">Lägg till</button>
                    </form>
                </div>
            </div>
        </section>
        
        <!-- Modal för felmeddelanden -->
        <div id="errorModal" class="modal">
            <div class="modal-content">
                <span id="close-error-modal" class="modal-close-btn">&times;</span>
                <p id="error-message" class="text-lg font-semibold text-red-600"></p>
            </div>
        </div>

        <!-- Bekräftelse-modal -->
        <div id="confirmationModal" class="modal">
            <div class="modal-content">
                <p id="confirmation-message" class="text-lg font-semibold text-green-600"></p>
            </div>
        </div>

    </main>
    
    <!-- Firebase SDK-skript -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // VÄNLIGEN FYLL I DIN UNIKA FIREBASE-KONFIGURATION HÄR.
        // Du hittar denna information i ditt Firebase-projekt under Project settings > General.
        // Ersätt de tomma strängarna med dina faktiska värden från din app.
        const firebaseConfig = {
            apiKey: "AIzaSyCorCZf8cH8vD1v47aOADdW3x0hCWlVUfw",
            authDomain: "kumlaskytte.firebaseapp.com",
            projectId: "kumlaskytte",
            storageBucket: "kumlaskytte.firebasestorage.app",
            messagingSenderId: "571676149705",
            appId: "1:571676149705:web:a0ace868f4680298a78a18",
            measurementId: "G-KSJ9NLNDBX"
        };

        // Kontrollerar om Firebase-konfigurationen finns
        const firebaseConfigExists = Object.keys(firebaseConfig).length > 0 && firebaseConfig.apiKey.length > 0;
        let db;
        let auth;

        // --- MODAL-FUNKTIONER ---
        function showModal(modalId, message) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            const messageEl = modal.querySelector('p');
            if (messageEl) {
                messageEl.textContent = message;
            }
            modal.classList.add('active');
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('active');
        }

        // --- RENDERING AV INNEHÅLL ---
        function renderNews(news) {
            const homeNewsContainer = document.getElementById('home-news-container');
            const allNewsContainer = document.getElementById('all-news-container');

            if (!homeNewsContainer || !allNewsContainer) return;

            homeNewsContainer.innerHTML = '';
            allNewsContainer.innerHTML = '';

            news.sort((a, b) => {
                const dateA = a.createdAt?.toDate() || new Date(a.date);
                const dateB = b.createdAt?.toDate() || new Date(b.date);
                return dateB - dateA;
            });
            
            // Visa de 2 senaste nyheterna på startsidan
            news.slice(0, 2).forEach(item => {
                const date = item.createdAt?.toDate() || new Date(item.date);
                const formattedDate = date.toLocaleDateString('sv-SE', { day: 'numeric', month: 'long', year: 'numeric' });
                homeNewsContainer.innerHTML += `
                    <div class="card">
                        <h3 class="text-2xl font-semibold mb-2">${item.title}</h3>
                        <p class="text-sm text-gray-500 mb-2">Publicerad: ${formattedDate}</p>
                        <p class="text-gray-700">${item.content}</p>
                    </div>
                `;
            });

            // Visa alla nyheter på nyhetssidan
            news.forEach(item => {
                const date = item.createdAt?.toDate() || new Date(item.date);
                const formattedDate = date.toLocaleDateString('sv-SE', { day: 'numeric', month: 'long', year: 'numeric' });
                allNewsContainer.innerHTML += `
                    <div class="card">
                        <h3 class="text-2xl font-semibold mb-2">${item.title}</h3>
                        <p class="text-sm text-gray-500 mb-2">Publicerad: ${formattedDate}</p>
                        <p class="text-gray-700">${item.content}</p>
                    </div>
                `;
            });
        }
        
        function renderEvents(events) {
            const calendarContainer = document.getElementById('calendar-container');
            if (!calendarContainer) return;

            calendarContainer.innerHTML = '';
            
            events.sort((a, b) => new Date(a.date) - new Date(b.date)); 

            events.forEach(item => {
                const eventDate = new Date(item.date);
                const day = eventDate.getDate();
                const month = eventDate.toLocaleString('sv-SE', { month: 'short' });

                calendarContainer.innerHTML += `
                    <div class="card flex items-start">
                        <div class="flex-shrink-0 bg-blue-500 text-white font-bold p-4 rounded-lg text-center mr-4">
                            <p class="text-xl leading-none">${day}</p>
                            <p class="text-xs uppercase">${month}</p>
                        </div>
                        <div>
                            <h3 class="text-2xl font-semibold mb-1">${item.title}</h3>
                            <p class="text-sm text-gray-500 mb-2">${item.date}</p>
                            <p class="text-gray-700">${item.description}</p>
                        </div>
                    </div>
                `;
            });
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            const statusIndicator = document.createElement('div');
            statusIndicator.className = "p-2 rounded-lg text-white font-semibold text-center mb-4";
            document.getElementById('admin-panel').prepend(statusIndicator);

            if (firebaseConfigExists) {
                try {
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    
                    statusIndicator.textContent = "Firebase är ansluten.";
                    statusIndicator.classList.add('bg-green-500');

                    await signInAnonymously(auth);

                    auth.onAuthStateChanged((user) => {
                        if (user) {
                            console.log("Authenticated with Firebase:", user.uid);
                            document.getElementById('add-news-btn').disabled = false;
                            document.getElementById('add-news-btn').classList.remove('bg-gray-400');
                            document.getElementById('add-news-btn').classList.add('bg-blue-600', 'hover:bg-blue-700');
                            document.getElementById('add-event-btn').disabled = false;
                            document.getElementById('add-event-btn').classList.remove('bg-gray-400');
                            document.getElementById('add-event-btn').classList.add('bg-blue-600', 'hover:bg-blue-700');

                            const newsRef = collection(db, `data/public-news`);
                            onSnapshot(newsRef, (snapshot) => {
                                const news = [];
                                snapshot.forEach(doc => {
                                    news.push({ id: doc.id, ...doc.data() });
                                });
                                renderNews(news);
                            });

                            const eventsRef = collection(db, `data/public-events`);
                            onSnapshot(eventsRef, (snapshot) => {
                                const events = [];
                                snapshot.forEach(doc => {
                                    events.push({ id: doc.id, ...doc.data() });
                                });
                                renderEvents(events);
                            });
                        } else {
                            console.log("Not authenticated with Firebase.");
                        }
                    });
                } catch (initError) {
                    console.error("Error initializing Firebase App:", initError);
                    statusIndicator.textContent = "Fel: Kunde inte ansluta till Firebase.";
                    statusIndicator.classList.remove('bg-green-500');
                    statusIndicator.classList.add('bg-red-500');
                }
            } else {
                statusIndicator.textContent = "Fel: Firebase-konfiguration saknas.";
                statusIndicator.classList.remove('bg-green-500');
                statusIndicator.classList.add('bg-red-500');
            }

            // --- MODAL EVENT LYSSNARE ---
            const errorModal = document.getElementById('errorModal');
            const closeErrorModalBtn = document.getElementById('close-error-modal');
            if (closeErrorModalBtn) {
                closeErrorModalBtn.addEventListener('click', () => {
                    hideModal('errorModal');
                });
            }
            if (errorModal) {
                errorModal.addEventListener('click', (event) => {
                    if (event.target === errorModal) {
                        hideModal('errorModal');
                    }
                });
            }

            const confirmationModal = document.getElementById('confirmationModal');
            if (confirmationModal) {
                confirmationModal.addEventListener('click', (event) => {
                    if (event.target === confirmationModal) {
                        hideModal('confirmationModal');
                    }
                });
            }

            // --- ENKEL ROUTER FÖR SIDVÄXLING ---
            function navigate(hash) {
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                const targetPage = document.querySelector(hash);
                if (targetPage) {
                    targetPage.classList.add('active');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    document.getElementById('hem').classList.add('active');
                }
            }

            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const hash = e.target.getAttribute('href');
                    history.pushState(null, '', hash);
                    navigate(hash);
                });
            });

            window.addEventListener('popstate', () => {
                navigate(window.location.hash || '#hem');
            });
            
            navigate(window.location.hash || '#hem');

            // --- ADMINPANELENS LOGIK ---
            const adminPassword = 'admin';
            const loginBtn = document.getElementById('login-btn');
            const adminPasswordInput = document.getElementById('admin-password');
            const adminLoginPanel = document.getElementById('admin-login-panel');
            const adminPanel = document.getElementById('admin-panel');
            const adminUserInfo = document.getElementById('admin-user-info');

            loginBtn.addEventListener('click', () => {
                if (adminPasswordInput.value === adminPassword) {
                    adminLoginPanel.classList.add('hidden');
                    adminPanel.classList.remove('hidden');
                    if (auth && auth.currentUser) {
                        adminUserInfo.textContent = `Du är inloggad som administratör (Användar-ID: ${auth.currentUser.uid})`;
                    }
                } else {
                    showModal('errorModal', 'Felaktigt lösenord!');
                }
            });

            // --- FORMULÄR FÖR ATT LÄGGA TILL DATA TILL FIREBASE ---
            const addNewsForm = document.getElementById('add-news-form');
            addNewsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!db) {
                    showModal('errorModal', "Databasen är inte ansluten. Vänligen ladda om sidan.");
                    return;
                }
                const newNews = {
                    title: document.getElementById('news-title').value,
                    content: document.getElementById('news-content').value,
                    createdAt: serverTimestamp()
                };
                
                try {
                    await addDoc(collection(db, `data/public-news`), newNews);
                    console.log("Nyhet tillagd!");
                    addNewsForm.reset();
                    showModal('confirmationModal', "Nyhet har lagts till!");
                    setTimeout(() => hideModal('confirmationModal'), 2000); // Dölj modalen automatiskt
                } catch (error) {
                    console.error("Fel vid tillägg av nyhet:", error);
                    showModal('errorModal', "Ett fel uppstod när nyheten skulle läggas till.");
                }
            });

            const addEventForm = document.getElementById('add-event-form');
            addEventForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!db) {
                    showModal('errorModal', "Databasen är inte ansluten. Vänligen ladda om sidan.");
                    return;
                }
                const newEvent = {
                    title: document.getElementById('event-title').value,
                    date: document.getElementById('event-date').value,
                    description: document.getElementById('event-description').value,
                    createdAt: serverTimestamp()
                };
                
                try {
                    await addDoc(collection(db, `data/public-events`), newEvent);
                    console.log("Händelse tillagd!");
                    addEventForm.reset();
                    showModal('confirmationModal', "Händelse har lagts till!");
                    setTimeout(() => hideModal('confirmationModal'), 2000); // Dölj modalen automatiskt
                } catch (error) {
                    console.error("Fel vid tillägg av händelse:", error);
                    showModal('errorModal', "Ett fel uppstod när händelsen skulle läggas till.");
                }
            });
        });
    </script>
</body>
</html>

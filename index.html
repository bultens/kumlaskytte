<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klubbens Webbplats</title>
    <!-- Använd Tailwind CSS för en snygg och responsiv design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1-px rgba(0, 0, 0, 0.06);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        /* Modal-styling för felmeddelanden och bekräftelse */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 0.75rem;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        .modal-close-btn {
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Header och navigering -->
    <header class="bg-blue-800 text-white shadow-lg">
        <div class="container py-4 flex flex-col sm:flex-row justify-between items-center">
            <a href="#" class="text-3xl font-bold tracking-tight mb-4 sm:mb-0">Klubbnamn</a>
            <nav>
                <ul class="flex space-x-4 font-medium">
                    <li><a href="#hem" class="hover:text-gray-300 transition duration-300">Hem</a></li>
                    <li><a href="#nyheter" class="hover:text-gray-300 transition duration-300">Nyheter</a></li>
                    <li><a href="#kalender" class="hover:text-gray-300 transition duration-300">Kalender</a></li>
                    <li><a href="#admin" class="hover:text-gray-300 transition duration-300">Admin</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Huvudinnehåll -->
    <main class="container">

        <!-- Sida: Hem -->
        <section id="hem" class="page active">
            <div class="bg-blue-100 p-8 rounded-xl text-center mb-8">
                <h1 class="text-4xl font-extrabold text-blue-900 mb-4">Välkommen till Klubbnamn!</h1>
                <p class="text-lg text-blue-700">Vi är en klubb för entusiaster av [klubben's intresse]. Här kan du hitta information om vår historia, nyheter och kommande evenemang.</p>
            </div>
            
            <h2 class="text-3xl font-bold mb-4">Senaste Nyheterna</h2>
            <div id="home-news-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Nyheter kommer att renderas här av JavaScript -->
            </div>

            <div class="mt-8 card">
                <h2 class="text-3xl font-bold mb-4">Klubbens Historia</h2>
                <p class="text-gray-700 leading-relaxed">
                    Klubbens historia sträcker sig tillbaka till [År]. Grundad av en passionerad grupp av [intresse], har vi vuxit till en samlingspunkt för likasinnade. Genom åren har vi arrangerat otaliga evenemang och byggt en stark gemenskap. Vårt mål är att fortsätta [klubbens mål].
                </p>
            </div>
        </section>

        <!-- Sida: Nyheter -->
        <section id="nyheter" class="page">
            <h1 class="text-4xl font-bold mb-6">Alla Nyheter</h1>
            <div id="all-news-container" class="space-y-6">
                <!-- Nyheter kommer att renderas här av JavaScript -->
            </div>
        </section>

        <!-- Sida: Kalender -->
        <section id="kalender" class="page">
            <h1 class="text-4xl font-bold mb-6">Kalender</h1>
            <div id="calendar-container" class="space-y-6">
                <!-- Kalenderhändelser kommer att renderas här av JavaScript -->
            </div>
        </section>

        <!-- Sida: Admin -->
        <section id="admin" class="page">
            <div id="admin-login-panel" class="card max-w-md mx-auto">
                <h1 class="text-2xl font-bold mb-4">Admininloggning</h1>
                <input type="password" id="admin-password" placeholder="Lösenord" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                <button id="login-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-300">Logga in</button>
            </div>

            <div id="admin-panel" class="hidden">
                <h1 class="text-4xl font-bold mb-6">Administrationspanel</h1>
                <div id="admin-user-info" class="mb-4 text-sm text-gray-500"></div>
                
                <div class="card">
                    <h2 class="text-2xl font-bold mb-4">Lägg till Nyhet</h2>
                    <div id="news-confirmation-message" class="text-center p-3 font-semibold rounded-lg hidden"></div>
                    <form id="add-news-form">
                        <label for="news-title" class="block mb-2 font-semibold">Titel</label>
                        <input type="text" id="news-title" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                        
                        <label for="news-content" class="block mb-2 font-semibold">Innehåll</label>
                        <textarea id="news-content" rows="6" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"></textarea>
                        
                        <button type="submit" id="add-news-btn" disabled class="bg-gray-400 text-white font-bold py-3 px-4 rounded-lg">Lägg till</button>
                    </form>
                </div>

                <div class="card mt-6">
                    <h2 class="text-2xl font-bold mb-4">Lägg till Kalenderhändelse</h2>
                    <div id="event-confirmation-message" class="text-center p-3 font-semibold rounded-lg hidden"></div>
                    <form id="add-event-form">
                        <label for="event-title" class="block mb-2 font-semibold">Titel</label>
                        <input type="text" id="event-title" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">

                        <label for="event-date" class="block mb-2 font-semibold">Datum</label>
                        <input type="date" id="event-date" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                        
                        <label for="event-description" class="block mb-2 font-semibold">Beskrivning</label>
                        <textarea id="event-description" rows="4" required class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"></textarea>
                        
                        <button type="submit" id="add-event-btn" disabled class="bg-gray-400 text-white font-bold py-3 px-4 rounded-lg">Lägg till</button>
                    </form>
                </div>
            </div>
        </section>
        
        <!-- Modal för felmeddelanden -->
        <div id="errorModal" class="modal">
            <div class="modal-content">
                <span class="modal-close-btn">&times;</span>
                <p id="modal-message" class="text-lg font-semibold text-red-600"></p>
            </div>
        </div>

        <!-- Bekräftelse-modal -->
        <div id="confirmationModal" class="modal">
            <div class="modal-content">
                <p id="confirmation-message" class="text-lg font-semibold text-green-600"></p>
            </div>
        </div>

    </main>
    
    <!-- Firebase SDK skript -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        // De globala variablerna som tillhandahålls av miljön för Firebase
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = {
            apiKey: "AIzaSyCorCZf8cH8vD1v47aOADdW3x0hCWlVUfw",
            authDomain: "kumlaskytte.firebaseapp.com",
            projectId: "kumlaskytte",
            storageBucket: "kumlaskytte.firebasestorage.app",
            appId: "1:571676149705:web:a0ace868f4680298a78a18"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db;
        let auth;
        
        // --- RENDERING AV INNEHÅLL ---
        // Funktion för att visa nyheter
        function renderNews(news) {
            const homeNewsContainer = document.getElementById('home-news-container');
            homeNewsContainer.innerHTML = '';
            news.slice(0, 2).forEach(item => {
                homeNewsContainer.innerHTML += `
                    <div class="card">
                        <h3 class="text-2xl font-semibold mb-2">${item.title}</h3>
                        <p class="text-sm text-gray-500 mb-2">Publicerad: ${item.date}</p>
                        <p class="text-gray-700">${item.content}</p>
                    </div>
                `;
            });

            const allNewsContainer = document.getElementById('all-news-container');
            allNewsContainer.innerHTML = '';
            news.forEach(item => {
                allNewsContainer.innerHTML += `
                    <div class="card">
                        <h3 class="text-2xl font-semibold mb-2">${item.title}</h3>
                        <p class="text-sm text-gray-500 mb-2">Publicerad: ${item.date}</p>
                        <p class="text-gray-700">${item.content}</p>
                    </div>
                `;
            });
        }
        
        // Funktion för att visa kalenderhändelser
        function renderEvents(events) {
            const calendarContainer = document.getElementById('calendar-container');
            calendarContainer.innerHTML = '';
            events.forEach(item => {
                calendarContainer.innerHTML += `
                    <div class="card flex items-start">
                        <div class="flex-shrink-0 bg-blue-500 text-white font-bold p-4 rounded-lg text-center mr-4">
                            <p class="text-xl leading-none">${new Date(item.date).getDate()}</p>
                            <p class="text-xs uppercase">${new Date(item.date).toLocaleString('sv-SE', { month: 'short' })}</p>
                        </div>
                        <div>
                            <h3 class="text-2xl font-semibold mb-1">${item.title}</h3>
                            <p class="text-sm text-gray-500 mb-2">${item.date}</p>
                            <p class="text-gray-700">${item.description}</p>
                        </div>
                    </div>
                `;
            });
        }
        
        // Funktion för att visa bekräftelse-meddelande
        function showConfirmation(message, elementId) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.classList.remove('hidden');
            el.classList.add('bg-green-100', 'text-green-800');
            setTimeout(() => {
                el.classList.add('hidden');
            }, 3000); // Dölj meddelandet efter 3 sekunder
        }

        // Funktion för att visa fel-meddelande
        function showError(message, elementId) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.classList.remove('hidden');
            el.classList.add('bg-red-100', 'text-red-800');
            setTimeout(() => {
                el.classList.add('hidden');
            }, 3000); // Dölj meddelandet efter 3 sekunder
        }


        document.addEventListener('DOMContentLoaded', async () => {

            // --- FIREBASE-INITIALISERING ---
            if (Object.keys(firebaseConfig).length > 0) {
                try {
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    
                    console.log("Firebase App initialized successfully.");

                    // Försöker logga in anonymt för att ansluta till databasen
                    try {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously.");
                        document.getElementById('add-news-btn').disabled = false;
                        document.getElementById('add-news-btn').classList.remove('bg-gray-400');
                        document.getElementById('add-news-btn').classList.add('bg-blue-600', 'hover:bg-blue-700');
                        document.getElementById('add-event-btn').disabled = false;
                        document.getElementById('add-event-btn').classList.remove('bg-gray-400');
                        document.getElementById('add-event-btn').classList.add('bg-blue-600', 'hover:bg-blue-700');
                    } catch (anonError) {
                        console.error("Error signing in anonymously:", anonError);
                        // Använd den inbyggda felvisningen
                        const adminPanel = document.getElementById('admin-panel');
                        if (adminPanel) {
                            const errorEl = document.createElement('div');
                            errorEl.textContent = "Ett fel uppstod vid inloggning. Vänligen kontakta support.";
                            errorEl.className = "text-red-500 p-2 mb-2";
                            adminPanel.prepend(errorEl);
                        }
                    }
                } catch (initError) {
                    console.error("Error initializing Firebase App:", initError);
                    const adminPanel = document.getElementById('admin-panel');
                    if (adminPanel) {
                        const errorEl = document.createElement('div');
                        errorEl.textContent = "Ett fel uppstod vid initialisering av Firebase. Kontrollera din konfiguration.";
                        errorEl.className = "text-red-500 p-2 mb-2";
                        adminPanel.prepend(errorEl);
                    }
                }
            } else {
                console.error("Firebase config is missing. The app will not function correctly.");
                const adminPanel = document.getElementById('admin-panel');
                if (adminPanel) {
                    const errorEl = document.createElement('div');
                    errorEl.textContent = "Fel: Firebase-konfiguration saknas. Appen kommer inte att fungera korrekt.";
                    errorEl.className = "text-red-500 p-2 mb-2";
                    adminPanel.prepend(errorEl);
                }
            }

            // --- ENKEL ROUTER FÖR SIDVÄXLING ---
            function navigate(hash) {
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                const targetPage = document.querySelector(hash);
                if (targetPage) {
                    targetPage.classList.add('active');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    document.getElementById('hem').classList.add('active');
                }
            }

            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const hash = e.target.getAttribute('href');
                    history.pushState(null, '', hash);
                    navigate(hash);
                });
            });

            window.addEventListener('popstate', () => {
                navigate(window.location.hash || '#hem');
            });
            
            navigate(window.location.hash || '#hem');

            // --- ADMINPANELENS LOGIK ---
            const adminPassword = 'admin';
            const loginBtn = document.getElementById('login-btn');
            const adminPasswordInput = document.getElementById('admin-password');
            const adminLoginPanel = document.getElementById('admin-login-panel');
            const adminPanel = document.getElementById('admin-panel');
            const adminUserInfo = document.getElementById('admin-user-info');

            loginBtn.addEventListener('click', () => {
                if (adminPasswordInput.value === adminPassword) {
                    adminLoginPanel.classList.add('hidden');
                    adminPanel.classList.remove('hidden');
                    if (auth && auth.currentUser) {
                        adminUserInfo.textContent = `Du är inloggad som administratör (Användar-ID: ${auth.currentUser.uid})`;
                    }
                } else {
                    const errorEl = document.createElement('div');
                    errorEl.textContent = "Felaktigt lösenord!";
                    errorEl.className = "text-red-500 p-2 mb-2";
                    adminLoginPanel.prepend(errorEl);
                }
            });

            // --- FIREBASE DATAHANTERING ---
            // onSnapshot lyssnar på ändringar i realtid och uppdaterar UI
            if (db) {
                // Lyssnar på nyheter
                const newsRef = collection(db, `artifacts/${appId}/public/data/news`);
                onSnapshot(newsRef, (snapshot) => {
                    const news = [];
                    snapshot.forEach(doc => {
                        news.push({ id: doc.id, ...doc.data() });
                    });
                    news.sort((a, b) => {
                        const dateA = a.createdAt?.toDate() || new Date(a.date);
                        const dateB = b.createdAt?.toDate() || new Date(b.date);
                        return dateB - dateA;
                    });
                    renderNews(news);
                });

                // Lyssnar på kalenderhändelser
                const eventsRef = collection(db, `artifacts/${appId}/public/data/events`);
                onSnapshot(eventsRef, (snapshot) => {
                    const events = [];
                    snapshot.forEach(doc => {
                        events.push({ id: doc.id, ...doc.data() });
                    });
                    events.sort((a, b) => new Date(a.date) - new Date(b.date));
                    renderEvents(events);
                });
            }

            // --- FORMULÄR FÖR ATT LÄGGA TILL DATA TILL FIREBASE ---
            const addNewsForm = document.getElementById('add-news-form');
            addNewsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!db) {
                    showError("Databasen är inte ansluten. Vänligen ladda om sidan.", 'news-confirmation-message');
                    return;
                }
                const newNews = {
                    title: document.getElementById('news-title').value,
                    content: document.getElementById('news-content').value,
                    date: new Date().toISOString().slice(0, 10),
                    createdAt: serverTimestamp()
                };
                
                try {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/news`), newNews);
                    console.log("Nyhet tillagd!");
                    addNewsForm.reset();
                    showConfirmation("Nyhet har lagts till!", 'news-confirmation-message');
                } catch (error) {
                    console.error("Fel vid tillägg av nyhet:", error);
                    showError("Ett fel uppstod när nyheten skulle läggas till.", 'news-confirmation-message');
                }
            });

            const addEventForm = document.getElementById('add-event-form');
            addEventForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!db) {
                    showError("Databasen är inte ansluten. Vänligen ladda om sidan.", 'event-confirmation-message');
                    return;
                }
                const newEvent = {
                    title: document.getElementById('event-title').value,
                    date: document.getElementById('event-date').value,
                    description: document.getElementById('event-description').value,
                    createdAt: serverTimestamp()
                };
                
                try {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/events`), newEvent);
                    console.log("Händelse tillagd!");
                    addEventForm.reset();
                    showConfirmation("Händelse har lagts till!", 'event-confirmation-message');
                } catch (error) {
                    console.error("Fel vid tillägg av händelse:", error);
                    showError("Ett fel uppstod när händelsen skulle läggas till.", 'event-confirmation-message');
                }
            });
        });
    </script>
</body>
</html>
